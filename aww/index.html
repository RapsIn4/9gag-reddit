<!DOCTYPE html>
<!-- Created by Michael Ye -->
<html>
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
		<meta http-equiv="pragma" content="no-cache" />
		<title>reddit: the front page of the internet</title>
		<link href="../style.css" rel="stylesheet" type="text/css" />
		<script src="http://code.jquery.com/jquery-latest.js"></script>
		<script>
			// functions
			function youtube_parser(url) {
				var regExp = /.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;
				var match = url.match(regExp);
				if (match && match[1].length == 11) {
					return match[1];
				}
			}

			function printPosts(posts) {
				var result = "";

				for (var i = 0; i < posts.length; i++) {
					var iUrl = posts[i].data.url;
					result += "<div class=\"post\">";
					// post tag
					result += "<div class=\"media\">";
					// media tag
					// add media
					if (iUrl.indexOf(".jpg") != -1 || iUrl.indexOf(".png") != -1 || iUrl.indexOf(".jpeg") != -1 || iUrl.indexOf(".gif") != -1) {
						if (posts[i].data.over_18) {
							result += ("<img src=\"images/nsfw.png\" width=550 />");
						} else {
							result += ("<img src=\"" + iUrl + "\" width=550 />");
						}
					} else if (iUrl.indexOf("youtube.com") != -1) {
						result += ("<iframe width=\"550\" height=\"338\" src=\"http://www.youtube.com/embed/" + youtube_parser(iUrl) + "?rel=0\" frameborder=\"0\" allowfullscreen></iframe>");
					} else if (iUrl.indexOf("imgur.com") != -1 && iUrl.indexOf("/a/") == -1) {
						result += ("<img src=\"" + iUrl + ".jpg\" width=550 />");
					} else if (posts[i].data.thumbnail == "") {
						result += ("<img src=\"images/no-thumb.png\" width=100 />");
					} else if (posts[i].data.thumbnail == "self") {
						result += ("<img src=\"images/ama.png\" width=100 />");
					} else if (posts[i].data.thumbnail != "default") {
						result += ("<img src=\"" + posts[i].data.thumbnail + "\" width=100px />");
					} else {
						result += ("<img src=\"images/no-thumb.png\" width=100 />");
					}

					result += ("</div>");
					// close media tag
					result += ("<div class=\"postRight\">")
					result += ("<b><a href=\"" + iUrl + "\" target=\"_blank\">" + posts[i].data.title + "</a></b><br>");
					result += ("<div class=\"subreddit\">/r/" + posts[i].data.subreddit + "</div>");
					if (posts[i].data.over_18) {
						result += ("<span style=\"color:#da0000; font-weight:bold;\">NSFW</span>")
					}
					result += ("<div class=\"comments\"><a href=\"http://reddit.com" + posts[i].data.permalink + "\" target=\"_blank\">" + posts[i].data.num_comments + " comments</a></div>");
					result += ("<div class=\"voteBox\">");

					result += ("<div class=\"arrows\">");

					result += ("<div class=\"downarrow\">");
					result += ("</div>");
					// close downarrow
					result += ("<div class=\"uparrow\">");
					result += ("</div>");
					// close uparrow

					result += ("</div>");
					// close arrows

					result += ("<div class=\"score\">Score: ");
					result += (posts[i].data.score);
					result += ("</div>");
					// close score

					result += ("</div>");
					// close voteBox
					result += ("</div>");
					// close postRight tag
					result += ("</div>");
					// close post tag
				}

				return result;
			}

			// get json
			function mygetJSON() {
				$('#more').html("<img src=\"../images/loading.gif\"  width=\"50\"/>");
				$.getJSON(after, function foo(data) {
					json = data;
				})
				// if successful
				.success(function() {
					after = (myurl + "&after=" + json.data.after);
					var output = printPosts(json.data.children);
					$('#more').text("more");
					$('#listings').append(output);
				});
			}

		</script>
	</head>
	<!-- end of head -->

	<body>
		<div id="top">
			<div id="logo" onclick="location.href='index.html'"></div>
		</div>
		<div id="container">
			<div id="listings">
				<script>
					var done = false;
					var json;
					var myurl = "http://www.reddit.com/r/aww.json?jsonp=?";
					var after = myurl;

					mygetJSON(myurl);
				</script>

			</div>
			<!-- end of listings -->
			<div id="more">
				<img src="../images/loading.gif"  width="50"/>
			</div>
			<script>
				// more button

				$("#more").click(function() {
					mygetJSON(after);
				});
			</script>
		</div>
		<!-- end of container -->

		<div id="footer">
			Developed by Michael Ye
		</div>

	</body>
</html>